<div class="transacao-list-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Transações</h1>
      <p class="page-subtitle">Gerencie suas receitas e despesas</p>
    </div>
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="navigateToNew()">
        <mat-icon>add</mat-icon>
        Nova Transação
      </button>
      <button mat-stroked-button (click)="exportToCSV()">
        <mat-icon>download</mat-icon>
        Exportar
      </button>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="summary-cards">
    <mat-card class="summary-card receitas">
      <mat-card-content>
        <div class="summary-content">
          <div class="summary-icon">
            <mat-icon>trending_up</mat-icon>
          </div>
          <div class="summary-info">
            <h3>Receitas</h3>
            <p class="summary-value">{{ formatCurrency(totalReceitas) }}</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="summary-card despesas">
      <mat-card-content>
        <div class="summary-content">
          <div class="summary-icon">
            <mat-icon>trending_down</mat-icon>
          </div>
          <div class="summary-info">
            <h3>Despesas</h3>
            <p class="summary-value">{{ formatCurrency(totalDespesas) }}</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="summary-card saldo" [class.positive]="saldoTotal >= 0" [class.negative]="saldoTotal < 0">
      <mat-card-content>
        <div class="summary-content">
          <div class="summary-icon">
            <mat-icon>{{ saldoTotal >= 0 ? 'account_balance_wallet' : 'money_off' }}</mat-icon>
          </div>
          <div class="summary-info">
            <h3>Saldo</h3>
            <p class="summary-value">{{ formatCurrency(saldoTotal) }}</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Quick Filters -->
  <div class="quick-filters">
    <button mat-button (click)="filterByPeriod('today')" [class.active]="dataInicio === new Date().toISOString().split('T')[0]">
      Hoje
    </button>
    <button mat-button (click)="filterByPeriod('week')">
      Esta Semana
    </button>
    <button mat-button (click)="filterByPeriod('month')">
      Este Mês
    </button>
    <button mat-button (click)="filterByPeriod('year')">
      Este Ano
    </button>
    <mat-divider vertical></mat-divider>
    <button mat-button (click)="filterByType('RECEITA')" [class.active]="selectedTipo === 'RECEITA'">
      <mat-icon>trending_up</mat-icon>
      Receitas
    </button>
    <button mat-button (click)="filterByType('DESPESA')" [class.active]="selectedTipo === 'DESPESA'">
      <mat-icon>trending_down</mat-icon>
      Despesas
    </button>
    <button mat-button (click)="clearFilters()">
      <mat-icon>clear</mat-icon>
      Limpar
    </button>
  </div>

  <!-- Filters -->
  <mat-card class="filter-card">
    <mat-card-content>
      <div class="filter-grid">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Buscar transações</mat-label>
          <input matInput 
                 [(ngModel)]="searchTerm" 
                 (keyup.enter)="applyFilter()"
                 placeholder="Descrição...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Tipo</mat-label>
          <mat-select [(value)]="selectedTipo" (selectionChange)="applyFilter()">
            <mat-option value="">Todos</mat-option>
            <mat-option *ngFor="let tipo of tiposOptions" [value]="tipo">
              <mat-icon>{{ getTipoIcon(tipo) }}</mat-icon>
              {{ tipo }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Categoria</mat-label>
          <mat-select [(value)]="selectedCategoria" (selectionChange)="applyFilter()">
            <mat-option value="">Todas</mat-option>
            <mat-option *ngFor="let categoria of categoriasOptions" [value]="categoria">
              <mat-icon>{{ getCategoriaIcon(categoria) }}</mat-icon>
              {{ categoria }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Conta</mat-label>
          <mat-select [(value)]="selectedConta" (selectionChange)="applyFilter()">
            <mat-option value="">Todas</mat-option>
            <mat-option *ngFor="let conta of contasOptions" [value]="conta.id">
              {{ conta.nome }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Cartão</mat-label>
          <mat-select [(value)]="selectedCartao" (selectionChange)="applyFilter()">
            <mat-option value="">Todos</mat-option>
            <mat-option *ngFor="let cartao of cartoesOptions" [value]="cartao.id">
              {{ cartao.nomeDoCartao }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Data Início</mat-label>
          <input matInput 
                 type="date"
                 [(ngModel)]="dataInicio" 
                 (change)="applyFilter()">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Data Fim</mat-label>
          <input matInput 
                 type="date"
                 [(ngModel)]="dataFim" 
                 (change)="applyFilter()">
        </mat-form-field>

        <div class="filter-actions">
          <button mat-raised-button color="primary" (click)="applyFilter()">
            <mat-icon>search</mat-icon>
            Filtrar
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Carregando transações...</p>
  </div>

  <!-- Table -->
  <mat-card *ngIf="!loading" class="table-card">
    <div class="table-container">
      <table mat-table [dataSource]="dataSource" matSort class="transacoes-table">
        
        <!-- Data Column -->
        <ng-container matColumnDef="data">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Data</th>
          <td mat-cell *matCellDef="let transacao" class="data-cell">
            {{ formatDate(transacao.data) }}
          </td>
        </ng-container>

        <!-- Descrição Column -->
        <ng-container matColumnDef="descricao">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Descrição</th>
          <td mat-cell *matCellDef="let transacao" class="descricao-cell">
            <div class="transacao-info">
              <span class="transacao-descricao">{{ transacao.descricao }}</span>
              <span class="transacao-observacoes" *ngIf="transacao.observacoes">{{ transacao.observacoes }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Categoria Column -->
        <ng-container matColumnDef="categoria">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Categoria</th>
          <td mat-cell *matCellDef="let transacao">
            <mat-chip-set>
              <mat-chip class="categoria-chip">
                <mat-icon matChipAvatar>{{ getCategoriaIcon(transacao.categoria) }}</mat-icon>
                {{ transacao.categoria }}
              </mat-chip>
            </mat-chip-set>
          </td>
        </ng-container>

        <!-- Tipo Column -->
        <ng-container matColumnDef="tipo">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Tipo</th>
          <td mat-cell *matCellDef="let transacao">
            <mat-chip-set>
              <mat-chip [class]="'tipo-chip ' + getTipoColor(transacao.tipo)">
                <mat-icon matChipAvatar>{{ getTipoIcon(transacao.tipo) }}</mat-icon>
                {{ transacao.tipo }}
              </mat-chip>
            </mat-chip-set>
          </td>
        </ng-container>

        <!-- Valor Column -->
        <ng-container matColumnDef="valor">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Valor</th>
          <td mat-cell *matCellDef="let transacao" class="valor-cell">
            <span [class]="'valor-' + getTipoColor(transacao.tipo)">
              {{ formatCurrency(transacao.valor) }}
            </span>
          </td>
        </ng-container>

        <!-- Conta Column -->
        <ng-container matColumnDef="conta">
          <th mat-header-cell *matHeaderCellDef>Conta</th>
          <td mat-cell *matCellDef="let transacao" class="conta-cell">
            {{ getContaNome(transacao.contaId) }}
          </td>
        </ng-container>

        <!-- Cartão Column -->
        <ng-container matColumnDef="cartao">
          <th mat-header-cell *matHeaderCellDef>Cartão</th>
          <td mat-cell *matCellDef="let transacao" class="cartao-cell">
            {{ transacao.cartaoId ? getCartaoNome(transacao.cartaoId) : '-' }}
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Ações</th>
          <td mat-cell *matCellDef="let transacao" class="actions-cell">
            <button mat-icon-button 
                    [matTooltip]="'Visualizar transação'"
                    (click)="navigateToView(transacao)">
              <mat-icon>visibility</mat-icon>
            </button>
            <button mat-icon-button 
                    [matTooltip]="'Editar transação'"
                    (click)="navigateToEdit(transacao)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button 
                    [matTooltip]="'Excluir transação'"
                    color="warn"
                    (click)="deleteTransacao(transacao)">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <!-- Empty State -->
      <div *ngIf="dataSource.data.length === 0" class="empty-state">
        <mat-icon class="empty-icon">receipt_long</mat-icon>
        <h3>Nenhuma transação encontrada</h3>
        <p>Não há transações cadastradas ou que correspondam aos filtros aplicados.</p>
        <button mat-raised-button color="primary" (click)="navigateToNew()">
          <mat-icon>add</mat-icon>
          Cadastrar Primeira Transação
        </button>
      </div>
    </div>

    <!-- Paginator -->
    <mat-paginator 
      *ngIf="dataSource.data.length > 0"
      [length]="totalElements"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      [showFirstLastButtons]="true"
      (page)="onPageChange()"
      aria-label="Selecione a página das transações">
    </mat-paginator>
  </mat-card>
</div>